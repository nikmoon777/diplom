### Справка по технологиям:
- PostgreSQL (>= v10)
- - Используется база данных **tg_scam**
- Java (v17) / Maven
- Python (v3.10) / Python-venv / Python3-pip

### Справка по окружению (env):
- **TG_SCAM_BOT** - токен основного телеграм бота
- - 0000000:123456789qwertyuiopasdfghjkl987654321zxcvbnm
- **TG_SCAM_BAN_BOT_API_ID** - api_id юзер бота для расширения функционала
- - 0000000
- **TG_SCAM_BAN_BOT_API_HASH** - api_hash юзер бота для расширения функционала
- - 123456789qwertyuiopasdfghjkl987654321zxcvbnm
 
### Структура проекта:
- ```./rest-api``` - сервер проекта  **[тык](./rest-api)**
- ```./tg-bot``` - telegram боты проекта  **[тык](./tg-bot)**
- ```./startup.sh``` - скрипт запуска проекта  **[тык](./startup.sh)**
- ```./destroy.sh``` - скрипт остановки проекта  **[тык](./destroy.sh)**

### Первый запуск:
> При первом запуске проекта необходимо авторизовать юзербота для бана в Telegram. Для этого нужно перейти в директорию [tg-bot](./tg-bot) с ботами проекта и вручную запустить юзербота для бана командой ```python ban_bot.py```. Если это действительно первый запуск и бот еще не был авторизован, тогда программа попросит ввести номер телефона (обычно это происходит сразу, не более 5 с.), строго необходимо вводить номер телефона, на который было зарегистрировано Telegram API (TG_SCAM_BAN_BOT_API_ID). После придет сообщение с кодом подтверждения, который также необходимо ввести в соответствующее поле в программе. После всех ранее описанных действий программма как будто зависнет, это значит, что её можно прервать и запустить проект заново с помощью скрипта запуска (ниже).
#### Используйте для этого [startup.ban.bot.sh](scam-bot/tg-bot/startup.ban.bot.sh)

## Сервер проекта
#### Основной модуль проекта, используется для связи с базой данных и изменения её состояния в виде REST сервиса.
##### В директории содержится исходный код сервиса. А также скрипт для запуска **только** сервера проекта [startup.sh](./rest-api/startup.sh).

## Telegram боты проекта
### Основной бот, используется как основной бот проекта (см. /help при запуске бота).
#### Входная точка - скрипт [main.py](./tg-bot/main.py) (подробнее см. [startup.sh](./tg-bot/startup.sh), локальный запуск).
### Бот для бана (юзербот)
#### Входная точка - скрипт [ban_bot.py](./tg-bot/ban_bot.py) (подробнее см. [startup.sh](./tg-bot/startup.sh), локальный запуск).

## Скрипт запуска проекта
#### Быстрый интерактивный запуск всего проекта (подробнее ```bash startup.sh```), **запуск обязательно выполнять из [директории проекта](./)**.

## Скрипт остановки проекта
#### Остановка всего проекта **(в т.ч. всех сессий screen)** (подробнее ```bash destroy.sh```).

## Дополнительная глава
### Смена [картинок](./tg-bot/assets) для команды бота /check:
- Картинка, если пользователь есть в базе
- - **Обязательное** название файла: ```check_user__exists_in_base.jpg```
- - [Посмотреть](./tg-bot/assets/check_user__exists_in_base.jpg)
- Картинка, если пользователь нет в базе
- - **Обязательное** название файла: ```check_user__not_found_in_base.jpg```
- - [Посмотреть](./tg-bot/assets/check_user__not_found_in_base.jpg)
 
### Конфигурация сервера
#### Для изменения конфигурации сервера:  [тык](./rest-api/src/main/resources/)
- Обновление миграций  [тык](./rest-api/src/main/resources/db/migration/)
- Обновление настроек сервиса  [тык](./rest-api/src/main/resources/service.properties)

### Настройки сервиса [service.properties](./rest-api/src/main/resources/service.properties)
#### Для доступа к серверу проекта требуется передавать специальный пользовательский HTTP header, название которого представлено в атрибуте ```service.http.header.name``` (по-умолчанию, Access-Telegram). Установленный пользовательский HTTP header содержит строку с такой семантикой (сигнатурой): ```key[id]```, где key - это секретный ключ ```service.http.header.secret.key```, и id - telegram id пользователя, выполняющего запрос к сервису. Сервис обязан отклонить запрос, если ключ (key) ```service.http.header.secret.key``` не совпадает с заданым в [конфигурации](./rest-api/src/main/resources/service.properties)
